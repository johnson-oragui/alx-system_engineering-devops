#!/usr/bin/env bash
# configuraing a new ubuntu with nginx installation
set -euo pipefail  # Enable error checking

# Check if Nginx is installed, if not, install it
if ! command -v nginx &>/dev/null; then
  sudo apt-get update
  sudo apt-get install -y nginx
fi

# Create directory and index file if they don't exist
sudo mkdir -p /etc/nginx/html
sudo touch /etc/nginx/html/index.html
sudo chmod 644 /etc/nginx/html/index.html  # Adjust permissions as needed
sudo echo "Hello World!" | sudo tee /etc/nginx/html/index.html >/dev/null

# Configure Nginx
sudo tee /etc/nginx/sites-available/default >/dev/null <<EOF
server {
    listen 80;
    listen [::]:80 default_server;
    root   /etc/nginx/html;
    index  index.html index.htm;

    location /redirect_me {
        return 301 https://www.google.com/;
    }

    location / {
        try_files \$uri \$uri/ =404;
    }
}
EOF

# Enable the configuration
sudo ln -sf /etc/nginx/sites-available/default /etc/nginx/sites-enabled/default

# Restart Nginx
sudo systemctl restart nginx
